version: "3.8"

services:
  # Optional live polling loop (/fixtures?live=all every 15s)
  # Enable by setting config/jobs/live.yaml -> jobs[].filters.tracked_leagues (non-empty)
  live_loop:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - ./.env
    environment:
      DATABASE_URL: ${DATABASE_URL:-postgresql://postgres:postgres@postgres:5432/api_football}
      POSTGRES_HOST: ${POSTGRES_HOST:-postgres}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      POSTGRES_DB: ${POSTGRES_DB:-api_football}
      API_FOOTBALL_KEY: ${API_FOOTBALL_KEY}
      LOG_FILE: /app/logs/collector.jsonl
      REDIS_URL: ${REDIS_URL:-redis://redis:6379/0}
    command: ["python", "scripts/live_loop.py", "--interval", "15"]
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped


