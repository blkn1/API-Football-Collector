fixtures_fetch_mode: per_tracked_leagues  # global_by_date | per_tracked_leagues

jobs:
- job_id: daily_standings
  type: incremental_daily
  enabled: true
  priority: HIGH
  endpoint: /standings
  params:
    league: null
    season: null
  interval:
    type: cron
    # Steady-state: refresh standings a few times per day (catch-up completed).
    # This keeps data fresh without burning quota continuously.
    cron: "10 */2 * * *"
  mode:
    max_leagues_per_run: 10
  target_layer: raw+core
  dependencies:
  - bootstrap_leagues
  - bootstrap_teams
  coverage_target:
    endpoint: /standings
    league_id: null
    season: null
    min_records: 1
    max_lag_minutes: 1440

- job_id: daily_fixtures_by_date
  type: incremental_daily
  enabled: true
  priority: HIGH
  endpoint: /fixtures
  params:
    date: null
  interval:
    type: cron
    cron: "0 6 * * *"
  target_layer: raw+core+mart
  dependencies:

- job_id: injuries_hourly
  type: incremental_daily
  enabled: true
  priority: HIGH
  endpoint: /injuries
  params: {}
  interval:
    type: cron
    cron: "2 * * * *"
  target_layer: raw+core
  dependencies:
  - bootstrap_leagues
  - bootstrap_teams
  coverage_target:
    endpoint: /injuries
    min_records: 1
    max_lag_minutes: 120

- job_id: fixture_details_recent_finalize
  type: incremental_daily
  enabled: true
  priority: HIGH
  endpoint: /fixtures/*
  params: {}
  interval:
    type: cron
    cron: "30 6 * * *"
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date
  coverage_target:
    endpoint: /fixtures/details
    min_records: 1
    max_lag_minutes: 240

- job_id: fixture_details_backfill_90d
  type: incremental_daily
  enabled: false
  priority: MEDIUM
  endpoint: /fixtures/*
  params: {}
  interval:
    type: cron
    cron: "*/10 * * * *"
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date
  coverage_target:
    endpoint: /fixtures/details_backfill_90d
    min_records: 1
    max_lag_minutes: 1440

- job_id: fixture_details_backfill_season
  type: incremental_daily
  enabled: true
  priority: MEDIUM
  endpoint: /fixtures/*
  params: {}
  interval:
    type: cron
    cron: "5-59/10 * * * *"
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date
  coverage_target:
    endpoint: /fixtures/details_backfill_season
    min_records: 1
    max_lag_minutes: 1440

- job_id: top_scorers_daily
  type: incremental_daily
  enabled: true
  priority: MEDIUM
  endpoint: /players/topscorers
  params: {}
  interval:
    type: cron
    # TR 06:40 (scheduler timezone) - sync after Turkish leagues fixtures fetch
    cron: "40 6 * * *"
  target_layer: raw+core+mart
  dependencies:
  - bootstrap_leagues
  - bootstrap_teams
  coverage_target:
    endpoint: /players/topscorers
    league_id: null
    season: null
    min_records: 1
    max_lag_minutes: 1440

- job_id: team_statistics_refresh
  type: incremental_daily
  enabled: true
  priority: MEDIUM
  endpoint: /teams/statistics
  params: {}
  interval:
    type: cron
    # Staggered with fixtures_backfill_season to spread load across the hour.
    cron: "7-59/10 * * * *"
  target_layer: raw+core+mart
  dependencies:
  - bootstrap_leagues
  - bootstrap_teams
  coverage_target:
    endpoint: /teams/statistics
    league_id: null
    season: null
    min_records: 1
    max_lag_minutes: 1440

# DISABLED: Auto-finish stale fixtures (DB-only, 0 API calls).
# This prevents "stale live status" from polluting live dashboards.
# Reason: Replaced by auto_finish_stale_fixtures job which is more efficient.
# Maintenance: finalize fixtures that are still "NS/TBD" even though their kickoff time is in the past.
# This fixes cases where daily_fixtures_by_date ran early (UTC morning) and never re-polled to transition NS -> FT.
- job_id: auto_finish_stale_fixtures
  type: incremental_daily
  enabled: true
  priority: LOW
  endpoint: none  # DB-only job by default, but can optionally fetch from API if try_fetch_first=true
  params:
    threshold_hours: 2
    safety_lag_hours: 3
    max_fixtures_per_run: 1000
    dry_run: false
    try_fetch_first: false  # Set to true to attempt API fetch before auto-finishing (uses quota)
  interval:
    type: cron
    cron: "0 * * * *"  # Every hour
  target_layer: core
  dependencies:
  - daily_fixtures_by_date

# Verification job: Refresh auto-finished matches flagged for verification when quota allows
- job_id: auto_finish_verification
  type: incremental_daily
  enabled: true
  priority: LOW
  endpoint: /fixtures
  params:
    min_daily_quota: 50000  # Only run when quota is healthy
    batch_size: 20
    max_fixtures_per_run: 200
  interval:
    type: cron
    cron: "*/30 * * * *"  # Every 30 minutes
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date

# DISABLED: refresh stale "live" fixtures that haven't updated in a while.
# This prevents "stale live status" from polluting live dashboards and MCP live scans.
# Auto-finish handles this efficiently (DB-only, 0 API calls).
- job_id: stale_live_refresh
  type: incremental_daily
  enabled: false
  priority: LOW
  endpoint: /fixtures
  params:
    stale_threshold_minutes: 15
    batch_size: 20
    scope_source: daily
  interval:
    type: cron
    cron: "*/5 * * * *"
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date

# Maintenance: finalize fixtures that are still "NS/TBD" even though their kickoff time is in the past.
# Optimized: 60min threshold + every 30min check = max 1.5h delay for NS->FT transition.
- job_id: stale_scheduled_finalize
  type: incremental_daily
  enabled: true
  priority: LOW
  endpoint: /fixtures
  params:
    stale_threshold_minutes: 60
    lookback_days: 3
    batch_size: 20
    max_fixtures_per_run: 200
  interval:
    type: cron
    cron: "*/30 * * * *"
  target_layer: raw+core
  dependencies:
  - daily_fixtures_by_date

- job_id: fixtures_backfill_league_season
  type: incremental_daily
  enabled: true
  priority: MEDIUM
  endpoint: /fixtures
  params: {}
  interval:
    type: cron
    # Runs every 10 minutes, aligned on :00, :10, :20 ... (details backfill follows)
    cron: "0-59/10 * * * *"
  target_layer: raw+core
  coverage_target:
    endpoint: /fixtures_backfill
    min_records: 1
    max_lag_minutes: 1440

- job_id: standings_backfill_league_season
  type: incremental_daily
  enabled: false
  priority: LOW
  endpoint: /standings
  params: {}
  interval:
    type: cron
    cron: "*/10 * * * *"
  target_layer: raw+core
  coverage_target:
    endpoint: /standings_backfill
    min_records: 1
    max_lag_minutes: 1440

- job_id: season_rollover_watch
  type: incremental_daily
  enabled: true
  priority: LOW
  endpoint: /leagues
  params: {}
  interval:
    type: cron
    cron: '5 1 * * *'  # daily 01:05 UTC (production safe: after daily fixtures fetch completes)
  target_layer: raw

tracked_leagues:
- id: 39
  name: Premier League
  season: 2025
- id: 40
  name: Championship
  season: 2025
- id: 41
  name: League One
  season: 2025
- id: 42
  name: League Two
  season: 2025
- id: 61
  name: Ligue 1
  season: 2025
- id: 62
  name: Ligue 2
  season: 2025
- id: 78
  name: Bundesliga
  season: 2025
- id: 79
  name: 2. Bundesliga
  season: 2025
- id: 80
  name: 3. Liga
  season: 2025
- id: 88
  name: Eredivisie
  season: 2025
- id: 94
  name: Primeira Liga
  season: 2025
- id: 95
  name: Segunda Liga
  season: 2025
- id: 106
  name: Ekstraklasa
  season: 2025
- id: 111
  name: FAW Championship
  season: 2025
- id: 112
  name: Welsh Cup
  season: 2025
- id: 121
  name: DBU Pokalen
  season: 2025
- id: 135
  name: Serie A
  season: 2025
- id: 136
  name: Serie B
  season: 2025
- id: 140
  name: La Liga
  season: 2025
- id: 141
  name: Segunda División
  season: 2025
- id: 144
  name: Jupiler Pro League
  season: 2025
- id: 145
  name: Challenger Pro League
  season: 2025
- id: 162
  name: Primera División
  season: 2025
- id: 179
  name: Premiership
  season: 2025
- id: 180
  name: Championship
  season: 2025
- id: 183
  name: League One
  season: 2025
- id: 184
  name: League Cup
  season: 2025
- id: 185
  name: A-League
  season: 2025
- id: 188
  name: A-League
  season: 2025
- id: 197
  name: Super League 1
  season: 2025
- id: 203
  name: Süper Lig
  season: 2025
- id: 204
  name: 1. Lig
  season: 2025
- id: 206
  name: Turkey Cup
  season: 2025
- id: 207
  name: Super League
  season: 2025
- id: 208
  name: Challenge League
  season: 2025
- id: 210
  name: HNL
  season: 2025
- id: 218
  name: 2. Liga
  season: 2025
- id: 219
  name: 3. Liga
  season: 2025
- id: 241
  name: Copa Colombia
  season: 2025
- id: 242
  name: Liga Pro
  season: 2025
- id: 262
  name: Liga MX
  season: 2025
- id: 271
  name: NB I
  season: 2025
- id: 274
  name: Liga 1
  season: 2025
- id: 276
  name: FKF Premier League
  season: 2025
- id: 281
  name: Ligat Ha'al
  season: 2025
- id: 283
  name: Super Liga
  season: 2025
- id: 286
  name: Super Liga
  season: 2025
- id: 290
  name: Persian Gulf Pro League
  season: 2025
- id: 291
  name: Azadegan League
  season: 2025
- id: 296
  name: Thai League 1
  season: 2025
- id: 302
  name: League Cup
  season: 2025
- id: 303
  name: Division 1
  season: 2025
- id: 308
  name: 1a Divisão
  season: 2025
- id: 312
  name: 1. Hrvatska
  season: 2025
- id: 315
  name: Premijer Liga
  season: 2025
- id: 332
  name: Super Liga
  season: 2025
- id: 333
  name: Premier League
  season: 2025
- id: 344
  name: Primera División
  season: 2025
- id: 345
  name: Division di Honor
  season: 2025
- id: 370
  name: Football League - Highland League
  season: 2025
- id: 380
  name: USL Super League
  season: 2025
- id: 381
  name: 3. Liga
  season: 2025
- id: 390
  name: Ligat Ha'al
  season: 2025
- id: 393
  name: Serie C - Girone C
  season: 2025
- id: 396
  name: Tercera División RFEF - Group 5
  season: 2025
- id: 399
  name: Tercera División RFEF - Group 4
  season: 2025
- id: 407
  name: Tercera División RFEF - Group 3
  season: 2025
- id: 408
  name: Tercera División RFEF - Group 2
  season: 2025
- id: 419
  name: Tercera División RFEF - Group 1
  season: 2025
- id: 492
  name: Tweede Divisie
  season: 2025
- id: 516
  name: Super Cup
  season: 2024
- id: 570
  name: Premier League
  season: 2025
- id: 585
  name: Pro League
  status: DEPRECATED
  name: Pro League
  season: 2026
- id: 677
  name: QSL Cup
  season: 2025
- id: 701
  name: Liga Revelação U23
  season: 2025
- id: 705
  name: Campionato Primavera - 1
  season: 2025
- id: 828
  name: Ligue 2
  season: 2025
- id: 865
  name: Liga 3
  season: 2025
- id: 871
  name: Premier League Cup
  season: 2025
- id: 967
  name: Cup
  season: 2024
- id: 976
  name: Serie C - Promotion - Play-offs
  season: 2024
- id: 1059
  name: Recopa Catarinense
  season: 2024
- id: 1168
  name: FIFA Intercontinental Cup
  season: 2025
